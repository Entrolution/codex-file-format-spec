{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://codex.document/schemas/presentation.schema.json",
  "title": "Codex Presentation Layer",
  "description": "Schema for presentation layer files in a Codex document",
  "type": "object",
  "required": ["version", "type", "defaults", "styles"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Presentation format version",
      "pattern": "^\\d+\\.\\d+$"
    },
    "type": {
      "type": "string",
      "description": "Presentation type",
      "enum": ["paginated", "continuous", "responsive"]
    },
    "defaults": {
      "type": "object",
      "description": "Default styling values"
    },
    "pages": {
      "type": "array",
      "description": "Page definitions (paginated only)",
      "items": {
        "$ref": "#/$defs/page"
      }
    },
    "sections": {
      "type": "array",
      "description": "Section definitions (continuous only)",
      "items": {
        "$ref": "#/$defs/section"
      }
    },
    "breakpoints": {
      "type": "array",
      "description": "Responsive breakpoints",
      "items": {
        "$ref": "#/$defs/breakpoint"
      }
    },
    "pageTemplate": {
      "$ref": "#/$defs/pageTemplate"
    },
    "styles": {
      "type": "object",
      "description": "Style definitions",
      "additionalProperties": {
        "$ref": "#/$defs/style"
      }
    },
    "typography": {
      "type": "object",
      "description": "Document-level typography settings",
      "properties": {
        "hyphenation": {
          "type": "object",
          "description": "Hyphenation settings",
          "properties": {
            "enabled": { "type": "boolean" },
            "language": { "type": "string" },
            "minWordLength": { "type": "integer", "minimum": 1 },
            "minBefore": { "type": "integer", "minimum": 1 },
            "minAfter": { "type": "integer", "minimum": 1 },
            "maxConsecutive": { "type": "integer", "minimum": 1 }
          }
        },
        "widows": {
          "type": "integer",
          "description": "Minimum lines at top of page",
          "minimum": 1
        },
        "orphans": {
          "type": "integer",
          "description": "Minimum lines at bottom of page",
          "minimum": 1
        },
        "baselineGrid": {
          "type": "object",
          "description": "Baseline grid settings",
          "properties": {
            "enabled": { "type": "boolean" },
            "lineHeight": { "type": "string" },
            "offset": { "type": "string" }
          }
        },
        "lineNumbering": { "$ref": "#/$defs/lineNumbering" }
      }
    }
  },
  "$defs": {
    "page": {
      "type": "object",
      "required": ["number", "elements"],
      "properties": {
        "number": {
          "type": "integer",
          "minimum": 1,
          "description": "Page number"
        },
        "elements": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/pageElement"
          }
        }
      }
    },
    "pageElement": {
      "type": "object",
      "required": ["blockId", "position"],
      "properties": {
        "blockId": {
          "type": "string",
          "description": "Reference to content block ID"
        },
        "position": {
          "$ref": "#/$defs/position"
        },
        "style": {
          "type": "string",
          "description": "Named style to apply"
        },
        "overflow": {
          "type": "string",
          "enum": ["visible", "hidden", "flow"],
          "description": "Overflow behavior"
        },
        "zIndex": {
          "type": "integer",
          "description": "Stacking order (higher values render on top)"
        },
        "transform": {
          "$ref": "#/$defs/transform"
        }
      }
    },
    "position": {
      "type": "object",
      "required": ["x", "y", "width"],
      "properties": {
        "x": {
          "type": "string",
          "description": "X position"
        },
        "y": {
          "type": "string",
          "description": "Y position"
        },
        "width": {
          "type": "string",
          "description": "Width"
        },
        "height": {
          "type": "string",
          "description": "Height",
          "default": "auto"
        }
      }
    },
    "transform": {
      "type": "object",
      "description": "Transform properties for rotation, scaling, and skewing",
      "properties": {
        "rotate": {
          "type": "string",
          "description": "Rotation angle (e.g., '90deg', '-45deg', '0.5rad', '0.25turn')"
        },
        "scale": {
          "oneOf": [
            { "type": "number", "description": "Uniform scale factor" },
            {
              "type": "object",
              "properties": {
                "x": { "type": "number" },
                "y": { "type": "number" }
              },
              "required": ["x", "y"]
            }
          ]
        },
        "skewX": {
          "type": "string",
          "description": "Horizontal skew angle"
        },
        "skewY": {
          "type": "string",
          "description": "Vertical skew angle"
        },
        "translateX": {
          "type": "string",
          "description": "Horizontal translation"
        },
        "translateY": {
          "type": "string",
          "description": "Vertical translation"
        },
        "matrix": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 6,
          "maxItems": 6,
          "description": "Full 2D transform matrix [a, b, c, d, tx, ty]"
        },
        "origin": {
          "oneOf": [
            { "type": "string", "description": "Transform origin (e.g., 'center', 'top left')" },
            {
              "type": "object",
              "properties": {
                "x": { "type": "string" },
                "y": { "type": "string" }
              },
              "required": ["x", "y"]
            }
          ]
        }
      }
    },
    "section": {
      "type": "object",
      "required": ["blockRefs"],
      "properties": {
        "blockRefs": {
          "type": "array",
          "items": { "type": "string" },
          "description": "References to content block IDs"
        },
        "style": {
          "type": "string",
          "description": "Named style to apply"
        },
        "attributes": {
          "type": "object",
          "description": "Inline style attributes",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "breakpoint": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Breakpoint name"
        },
        "minWidth": {
          "type": "string",
          "description": "Minimum viewport width"
        },
        "maxWidth": {
          "type": "string",
          "description": "Maximum viewport width"
        }
      },
      "additionalProperties": false
    },
    "pageTemplate": {
      "type": "object",
      "properties": {
        "header": {
          "$ref": "#/$defs/pageHeaderFooter"
        },
        "footer": {
          "$ref": "#/$defs/pageHeaderFooter"
        }
      }
    },
    "pageHeaderFooter": {
      "type": "object",
      "properties": {
        "height": {
          "type": "string",
          "description": "Height of header/footer"
        },
        "content": {
          "type": "object",
          "properties": {
            "left": {
              "$ref": "#/$defs/headerFooterContent"
            },
            "center": {
              "$ref": "#/$defs/headerFooterContent"
            },
            "right": {
              "$ref": "#/$defs/headerFooterContent"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "headerFooterContent": {
      "oneOf": [
        { "type": "null" },
        {
          "type": "object",
          "properties": {
            "text": {
              "type": "string",
              "description": "Text with optional variables like {pageNumber}"
            }
          }
        }
      ]
    },
    "lineNumbering": {
      "type": "object",
      "description": "Line numbering configuration for margins",
      "required": ["enabled"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether line numbering is active"
        },
        "start": {
          "type": "integer",
          "description": "Starting line number",
          "minimum": 1,
          "default": 1
        },
        "interval": {
          "type": "integer",
          "description": "Number every N lines (1 = every line, 5 = every 5th line)",
          "minimum": 1,
          "default": 1
        },
        "side": {
          "type": "string",
          "description": "Which margin to display numbers",
          "enum": ["left", "right"],
          "default": "left"
        },
        "restart": {
          "type": "string",
          "description": "When to restart numbering",
          "enum": ["page", "section", "none"],
          "default": "page"
        },
        "scope": {
          "type": "array",
          "description": "Block types to number (if omitted, all content is numbered)",
          "items": { "type": "string" }
        },
        "style": {
          "type": "object",
          "description": "Styling for line numbers",
          "properties": {
            "fontSize": { "type": "string" },
            "color": { "type": "string" },
            "fontFamily": { "type": "string" },
            "marginRight": { "type": "string" },
            "marginLeft": { "type": "string" }
          }
        }
      }
    },
    "style": {
      "type": "object",
      "properties": {
        "extends": {
          "type": "string",
          "description": "Parent style to inherit from"
        },
        "base": {
          "type": "object",
          "description": "Base styles (for responsive)"
        },
        "fontFamily": { "type": "string" },
        "fontSize": { "type": "string" },
        "fontWeight": {
          "oneOf": [
            { "type": "integer", "minimum": 100, "maximum": 900 },
            { "type": "string", "enum": ["normal", "bold", "lighter", "bolder"] }
          ]
        },
        "fontStyle": {
          "type": "string",
          "enum": ["normal", "italic"]
        },
        "lineHeight": {
          "oneOf": [
            { "type": "number" },
            { "type": "string" }
          ]
        },
        "letterSpacing": { "type": "string" },
        "textAlign": {
          "type": "string",
          "enum": ["left", "center", "right", "justify"]
        },
        "textDecoration": {
          "type": "string",
          "enum": ["none", "underline", "line-through"]
        },
        "textTransform": {
          "type": "string",
          "enum": ["none", "uppercase", "lowercase", "capitalize"]
        },
        "writingMode": {
          "type": "string",
          "enum": ["horizontal-tb", "vertical-rl", "vertical-lr", "sideways-rl", "sideways-lr"],
          "description": "Text flow direction"
        },
        "color": { "type": "string" },
        "backgroundColor": { "type": "string" },
        "backgroundImage": {
          "type": "string",
          "description": "URL/path to background image"
        },
        "backgroundSize": {
          "type": "string",
          "description": "Background size (cover, contain, or dimensions)"
        },
        "backgroundPosition": {
          "type": "string",
          "description": "Background position"
        },
        "backgroundRepeat": {
          "type": "string",
          "enum": ["repeat", "no-repeat", "repeat-x", "repeat-y"],
          "description": "Background repeat behavior"
        },
        "opacity": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Element opacity (0-1)"
        },
        "marginTop": { "type": "string" },
        "marginRight": { "type": "string" },
        "marginBottom": { "type": "string" },
        "marginLeft": { "type": "string" },
        "paddingTop": { "type": "string" },
        "paddingRight": { "type": "string" },
        "paddingBottom": { "type": "string" },
        "paddingLeft": { "type": "string" },
        "borderWidth": { "type": "string" },
        "borderStyle": { "type": "string" },
        "borderColor": { "type": "string" },
        "borderRadius": {
          "type": "string",
          "description": "Corner rounding"
        },
        "boxShadow": {
          "type": "string",
          "description": "Box shadow effect"
        },
        "width": { "type": "string" },
        "height": { "type": "string" },
        "maxWidth": { "type": "string" },
        "maxHeight": { "type": "string" },
        "display": {
          "type": "string",
          "enum": ["block", "inline", "none"]
        },
        "pageBreakBefore": {
          "type": "string",
          "enum": ["auto", "always", "avoid"]
        },
        "pageBreakAfter": {
          "type": "string",
          "enum": ["auto", "always", "avoid"]
        }
      },
      "additionalProperties": false
    }
  }
}
