{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://codex.document/schemas/semantic.schema.json",
  "title": "Codex Semantic Extension",
  "description": "Schema for semantic extension blocks and marks in a Codex document",
  "$defs": {
    "citationMark": {
      "type": "object",
      "description": "Citation mark for referencing bibliography entries",
      "required": ["type", "refs"],
      "properties": {
        "type": { "const": "citation" },
        "refs": {
          "type": "array",
          "description": "Array of bibliography entry IDs",
          "items": { "type": "string" },
          "minItems": 1
        },
        "locator": {
          "type": "string",
          "description": "Page, chapter, section, or other locator (CSL-compatible, more general than pages)"
        },
        "locatorType": {
          "type": "string",
          "description": "Type of locator (CSL-compatible). Defaults to \"page\" if omitted.",
          "enum": [
            "page", "chapter", "section", "paragraph", "line",
            "verse", "volume", "issue", "part", "book",
            "figure", "table", "note", "opus", "sub-verbo"
          ]
        },
        "pages": {
          "type": "string",
          "description": "Page range (deprecated: prefer locator for flexibility)"
        },
        "prefix": {
          "type": "string",
          "description": "Text to display before the citation (e.g., 'see')"
        },
        "suffix": {
          "type": "string",
          "description": "Text to display after the citation"
        },
        "suppressAuthor": {
          "type": "boolean",
          "description": "If true, omit the author name from the citation",
          "default": false
        }
      }
    },
    "footnoteMark": {
      "type": "object",
      "description": "Footnote mark for referencing footnote content",
      "required": ["type"],
      "properties": {
        "type": { "const": "footnote" },
        "number": {
          "type": "integer",
          "description": "Sequential footnote number",
          "minimum": 1
        },
        "symbol": {
          "type": "string",
          "description": "Symbol-based footnote marker for author notes",
          "enum": ["asterisk", "dagger", "ddagger", "section", "parallel", "paragraph"]
        },
        "id": {
          "type": "string",
          "description": "Unique footnote identifier for cross-referencing"
        }
      },
      "oneOf": [
        { "required": ["number"] },
        { "required": ["symbol"] }
      ]
    },
    "entityMark": {
      "type": "object",
      "description": "Entity annotation for linking to knowledge graphs",
      "required": ["type", "uri"],
      "properties": {
        "type": { "const": "entity" },
        "uri": {
          "type": "string",
          "format": "uri",
          "description": "URI identifying the entity in a knowledge graph"
        },
        "entityType": {
          "type": "string",
          "description": "Schema.org type of the entity",
          "enum": ["Person", "Organization", "Place", "Event", "Product", "CreativeWork"]
        },
        "source": {
          "type": "string",
          "description": "Knowledge graph origin (e.g., 'wikidata', 'dbpedia')"
        }
      }
    },
    "glossaryMark": {
      "type": "object",
      "description": "Glossary mark for linking to term definitions",
      "required": ["type", "ref"],
      "properties": {
        "type": { "const": "glossary" },
        "ref": {
          "type": "string",
          "description": "Reference to the term definition ID"
        }
      }
    },
    "footnoteBlock": {
      "type": "object",
      "description": "Footnote content block",
      "required": ["type"],
      "properties": {
        "type": { "const": "semantic:footnote" },
        "number": {
          "type": "integer",
          "description": "Footnote number (must match corresponding mark)",
          "minimum": 1
        },
        "symbol": {
          "type": "string",
          "description": "Symbol-based footnote marker (must match corresponding mark)",
          "enum": ["asterisk", "dagger", "ddagger", "section", "parallel", "paragraph"]
        },
        "id": {
          "type": "string",
          "description": "Unique identifier (must match mark if present)"
        },
        "children": {
          "type": "array",
          "description": "Rich footnote content (paragraph blocks)"
        },
        "content": {
          "type": "string",
          "description": "Simple text content (alternative to children)"
        }
      },
      "allOf": [
        {
          "oneOf": [
            { "required": ["number"] },
            { "required": ["symbol"] }
          ]
        },
        {
          "oneOf": [
            { "required": ["children"] },
            { "required": ["content"] }
          ]
        }
      ]
    },
    "bibliographyEntry": {
      "type": "object",
      "description": "CSL JSON bibliography entry",
      "required": ["id", "type"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique entry identifier"
        },
        "type": {
          "type": "string",
          "description": "CSL entry type (e.g., 'article-journal', 'book', 'chapter')"
        },
        "title": {
          "type": "string",
          "description": "Title of the work"
        },
        "author": {
          "type": "array",
          "description": "Authors of the work",
          "items": {
            "type": "object",
            "properties": {
              "family": { "type": "string" },
              "given": { "type": "string" },
              "literal": { "type": "string" }
            }
          }
        },
        "issued": {
          "type": "object",
          "description": "Publication date",
          "properties": {
            "year": { "type": "integer" },
            "month": { "type": "integer" },
            "day": { "type": "integer" },
            "date-parts": {
              "type": "array",
              "items": {
                "type": "array",
                "items": { "type": "integer" }
              }
            }
          }
        },
        "container-title": {
          "type": "string",
          "description": "Journal, book, or proceedings title"
        },
        "volume": {
          "type": ["string", "integer"],
          "description": "Volume number"
        },
        "issue": {
          "type": ["string", "integer"],
          "description": "Issue number"
        },
        "page": {
          "type": "string",
          "description": "Page range"
        },
        "DOI": {
          "type": "string",
          "description": "Digital Object Identifier"
        },
        "URL": {
          "type": "string",
          "format": "uri",
          "description": "URL of the work"
        },
        "ISBN": {
          "type": "string",
          "description": "International Standard Book Number"
        },
        "ISSN": {
          "type": "string",
          "description": "International Standard Serial Number"
        },
        "publisher": {
          "type": "string",
          "description": "Publisher name"
        },
        "publisher-place": {
          "type": "string",
          "description": "Place of publication"
        },
        "renderedText": {
          "type": "string",
          "description": "Pre-rendered citation text from citeproc"
        }
      },
      "additionalProperties": true
    },
    "bibliographyBlock": {
      "type": "object",
      "description": "Bibliography block for rendering citations",
      "required": ["type"],
      "properties": {
        "type": { "const": "semantic:bibliography" },
        "style": {
          "type": "string",
          "description": "Citation style (e.g., 'apa', 'mla', 'chicago', 'ieee', 'harvard', 'vancouver')"
        },
        "title": {
          "type": "string",
          "description": "Bibliography section title"
        },
        "filter": {
          "type": ["string", "null"],
          "description": "Filter expression for selective bibliography"
        },
        "entries": {
          "type": "array",
          "description": "Inline CSL JSON entries (alternative to external bibliography.json)",
          "items": { "$ref": "#/$defs/bibliographyEntry" }
        }
      }
    },
    "termBlock": {
      "type": "object",
      "description": "Glossary term definition block",
      "required": ["type", "term", "definition"],
      "properties": {
        "type": { "const": "semantic:term" },
        "id": {
          "type": "string",
          "description": "Unique term identifier"
        },
        "term": {
          "type": "string",
          "description": "The term being defined"
        },
        "definition": {
          "type": "string",
          "description": "Definition of the term"
        },
        "see": {
          "type": "array",
          "description": "Related term IDs",
          "items": { "type": "string" }
        }
      }
    },
    "refBlock": {
      "type": "object",
      "description": "Cross-reference block for internal or external references",
      "required": ["type", "target"],
      "properties": {
        "type": { "const": "semantic:ref" },
        "target": {
          "type": "string",
          "description": "Target reference (Content Anchor URI for internal, URL for external)"
        },
        "format": {
          "type": "string",
          "description": "Display format template (e.g., 'Section {number}')"
        },
        "external": {
          "type": "boolean",
          "description": "If true, target is an external URL",
          "default": false
        },
        "children": {
          "type": "array",
          "description": "Display content (text nodes)"
        }
      }
    },
    "glossaryBlock": {
      "type": "object",
      "description": "Glossary block for rendering collected term definitions",
      "required": ["type"],
      "properties": {
        "type": { "const": "semantic:glossary" },
        "title": {
          "type": "string",
          "description": "Glossary section title"
        },
        "sort": {
          "type": "string",
          "description": "Sort order for terms",
          "enum": ["alphabetical", "appearance", "none"]
        }
      }
    },
    "measurementBlock": {
      "type": "object",
      "description": "Semantic measurement with linked data integration",
      "required": ["type", "value", "unit"],
      "properties": {
        "type": { "const": "semantic:measurement" },
        "value": {
          "type": "number",
          "description": "Numeric measurement value"
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement"
        },
        "schema": {
          "type": "object",
          "description": "Schema.org QuantitativeValue representation",
          "properties": {
            "@type": {
              "type": "string",
              "const": "QuantitativeValue"
            },
            "value": {
              "type": "number"
            },
            "unitCode": {
              "type": "string",
              "description": "UN/CEFACT unit code"
            },
            "unitText": {
              "type": "string",
              "description": "Human-readable unit name"
            }
          }
        }
      }
    },
    "jsonLdAnnotation": {
      "type": "object",
      "description": "JSON-LD semantic annotation for blocks",
      "properties": {
        "@context": {
          "oneOf": [
            { "type": "string", "format": "uri" },
            { "type": "object" }
          ],
          "description": "JSON-LD context"
        },
        "@type": {
          "type": "string",
          "description": "Schema.org or other vocabulary type"
        },
        "@id": {
          "type": "string",
          "description": "Unique identifier for the annotated content"
        }
      },
      "additionalProperties": true
    }
  },
  "type": "object",
  "description": "Semantic extension configuration",
  "properties": {
    "bibliography": {
      "type": "string",
      "description": "Path to bibliography file (e.g., 'semantic/bibliography.json')"
    },
    "glossary": {
      "type": "string",
      "description": "Path to glossary file (e.g., 'semantic/glossary.json')"
    }
  }
}
